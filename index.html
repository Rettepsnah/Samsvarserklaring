<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ground Handling Declaration Form</title>
    <style>
        :root {
            --primary-blue: #005596;
            --text-color: #000;
        }

        body {
            font-family: Arial, sans-serif;
            font-size: 13px;
            line-height: 1.4;
            color: var(--text-color);
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 210mm;
            margin: 0 auto;
            background: white;
            padding: 20mm;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            position: relative;
        }

        /* --- Header Styles --- */
        .header-bar {
            background-color: var(--primary-blue);
            color: white;
            padding: 8px 15px;
            font-weight: bold;
            font-size: 16px;
            display: flex;
            justify-content: space-between;
        }

        .reg-ref {
            text-align: right;
            font-size: 10px;
            font-style: italic;
            margin-top: 5px;
            margin-bottom: 20px;
        }

        .main-title {
            text-align: center;
            font-weight: bold;
            margin-bottom: 30px;
            text-transform: uppercase;
        }

        .main-title a { color: blue; text-decoration: underline; text-transform: none; }

        /* --- Form Elements --- */
        .form-row { margin-bottom: 15px; }
       
        label { font-weight: bold; display: block; margin-bottom: 5px; }
       
        input[type="text"], input[type="email"], input[type="date"], textarea {
            width: 100%;
            border: none;
            border-bottom: 1px dotted #000;
            background: transparent;
            font-family: inherit;
            font-size: inherit;
            outline: none;
            transition: background 0.3s;
        }

        /* ICAO Validation Colors */
        .valid-code { background-color: #e8f5e9 !important; }
        .invalid-code { background-color: #f8d7da !important; }
        .unknown-code { background-color: #fff3cd !important; }

        .checkbox-row {
            display: flex;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .checkbox-row input[type="checkbox"] {
            margin-top: 3px;
            margin-right: 15px;
            transform: scale(1.2);
        }

        .indent { margin-left: 25px; }

        /* --- Signature Pad Styles --- */
        .signature-wrapper {
            margin-top: 20px;
            padding: 10px;
            background-color: #fafafa;
            border: 1px dashed #ccc;
            position: relative;
        }
       
        canvas#sigCanvas {
            width: 100%;
            height: 120px;
            background-color: #fff;
            border-bottom: 1px solid #000;
            cursor: crosshair;
            touch-action: none; /* Prevents scrolling while signing */
        }

        .sig-clear-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 3px;
            padding: 2px 8px;
            font-size: 11px;
            cursor: pointer;
        }

        /* --- Tables --- */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            margin-bottom: 20px;
        }

        th, td {
            border: 1px solid #000;
            padding: 5px;
            vertical-align: middle;
        }

        th { background-color: #f9f9f9; text-align: left; font-size: 12px; }

        .bordered-section {
            border: 1px solid #000;
            padding: 10px;
            margin-bottom: -1px;
        }

        .statement-text { font-size: 12px; text-align: justify; }

        .page-break {
            margin-top: 40px;
            padding-top: 40px;
            border-top: 2px dashed #ccc;
        }

        /* --- UI Buttons --- */
        .ui-controls {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #eee;
            text-align: center;
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            color: white;
            font-size: 14px;
        }
        .btn-pdf { background-color: #28a745; }
        .btn-pdf:hover { background-color: #218838; }
        .btn-clear { background-color: #dc3545; }
        .btn-clear:hover { background-color: #c82333; }

        /* --- Print Styles --- */
        @media print {
            body { background-color: white; margin: 0; padding: 0; }
            .container { width: 100%; max-width: none; box-shadow: none; padding: 0; margin: 0; }
            .ui-controls, .sig-clear-btn { display: none !important; }
            .page-break { page-break-before: always; border-top: none; margin-top: 0; padding-top: 20px; }
            .valid-code, .invalid-code, .unknown-code { background-color: transparent !important; }
            .signature-wrapper { border: none; background: transparent; padding: 0; }
        }
    </style>
</head>
<body>

    <div class="container">
        <form id="declarationForm">
            <div class="header-bar">Appendix 1 — DECLARATION FORM</div>
            <div class="reg-ref">Regulation (EU) 2025/20</div>

            <div class="main-title">
                DECLARATION<br>
                <span style="font-size: 0.9em; text-transform: none; font-weight: normal;">
                    in accordance with <a href="https://www.easa.europa.eu/en/regulations/ground-handling">Commission Delegated Regulation (EU) 2025/20</a>
                </span>
            </div>

            <div style="border: 1px solid black; padding: 15px; margin-bottom: 20px;">
                <div class="form-row">
                    <label>Name of organisation:</label>
                    <input type="text">
                </div>

                <div class="form-row">
                    <label>Name, email and telephone number of the accountable manager:</label>
                    <input type="text">
                </div>

                <div class="form-row">
                    <label>Organisation’s principal place of business:</label>
                    <input type="text">
                </div>

                <div class="form-row" style="display: flex; justify-content: space-between; align-items: flex-start;">
                    <div style="width: 60%;"><strong>Provision of ground handling services:</strong></div>
                    <div style="width: 40%; text-align: right;">
                        To third-party aircraft operators <input type="checkbox"><br>
                        Self-handling<sup>(*)</sup> <input type="checkbox">
                    </div>
                </div>

                <div class="form-row">
                    <strong>This organisation is:</strong>
                    <div class="checkbox-row">
                        <input type="checkbox"> <span>a stand-alone ground handling organisation</span>
                    </div>
                    <div class="checkbox-row">
                        <input type="checkbox"> <span>integrated part of an aerodrome operator, namely <input type="text" style="width: 50%; display: inline;"></span>
                    </div>
                    <div class="checkbox-row">
                        <input type="checkbox"> <span>integrated part of an aircraft operator or of a single air carrier business grouping, namely</span>
                    </div>
                    <input type="text" class="indent" style="width: 95%;">
                </div>

                <div class="form-row">
                    <label>Name, email and telephone number of the person assigned with the ground handling safety function:</label>
                    <input type="text">
                </div>

                <div class="form-row">
                    <label>Intended date of starting ground handling operations<sup>(**)</sup>:</label>
                    <input type="date">
                </div>

                <div style="font-size: 0.8em; margin: 15px 0;">
                    (*): Including to aircraft operators part of the same single air carrier business grouping.<br>
                    (**): For organisations already operating at the date of application of this Regulation, this date shall indicate the date at which the declaration is submitted.
                </div>

                <label>EU aerodrome(s) at which the organisation provides services, in full name and ICAO code:</label>
                <table>
                    <thead>
                        <tr>
                            <th width="5%">Nº</th>
                            <th width="50%">Aerodrome name</th>
                            <th width="20%">ICAO code</th>
                            <th width="25%">State</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="lookup-row">
                            <td>1</td>
                            <td><input type="text" class="field-name" placeholder="Auto-fills..."></td>
                            <td><input type="text" class="field-icao" placeholder="e.g. ENGM" maxlength="4"></td>
                            <td><input type="text" class="field-state" placeholder="Auto-fills..."></td>
                        </tr>
                        <tr class="lookup-row">
                            <td>2</td>
                            <td><input type="text" class="field-name"></td>
                            <td><input type="text" class="field-icao" maxlength="4"></td>
                            <td><input type="text" class="field-state"></td>
                        </tr>
                        <tr class="lookup-row">
                            <td>3</td>
                            <td><input type="text" class="field-name"></td>
                            <td><input type="text" class="field-icao" maxlength="4"></td>
                            <td><input type="text" class="field-state"></td>
                        </tr>
                        <tr class="lookup-row">
                            <td>4</td>
                            <td><input type="text" class="field-name"></td>
                            <td><input type="text" class="field-icao" maxlength="4"></td>
                            <td><input type="text" class="field-state"></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div style="border: 1px solid black; margin-top: 20px;">
                <div style="padding: 5px 10px; font-weight: bold; border-bottom: 1px solid black;">Statements</div>

                <div class="bordered-section checkbox-row">
                    <input type="checkbox">
                    <div class="statement-text">The ground handling organisation has developed and implements a management system that includes a safety policy, safety risk management, and procedures for the provision of ground handling service(s) covered by this declaration, in accordance with the essential requirements set out in point 4.2 of Annex VII to Regulation (EU) 2018/1139 and in point ORGH.MGM.200 (Management system) of Annex I to Delegated Regulation (EU) 2025/20.</div>
                </div>

                <div class="bordered-section checkbox-row">
                    <input type="checkbox">
                    <div class="statement-text">(If applicable)<br>The AltMoC with references to the associated AMC they replace have been submitted to the competent authority.</div>
                </div>

                <div class="bordered-section checkbox-row">
                    <input type="checkbox">
                    <div class="statement-text">The ground handling services are carried out in accordance with the ground handling manual established as part of the essential requirements set out in point 4.2.3. of Annex VII to Regulation (EU) 2018/1139 and as required by point ORGH.DOC.110 of Annex I to Delegated Regulation (EU) 2025/20.</div>
                </div>

                <div class="bordered-section checkbox-row">
                    <input type="checkbox">
                    <div class="statement-text">All pieces of GSE used are current with the maintenance programme as specified in Subpart ORGH.GSE of Annex I to Delegated Regulation (EU) 2025/20.</div>
                </div>

                <div class="bordered-section checkbox-row">
                    <input type="checkbox">
                    <div class="statement-text">All ground handling personnel are trained in accordance with Subpart ORGH.TRG of Annex I to Delegated Regulation (EU) 2025/20 and their competence is maintained so that they perform their tasks safely and according to the standards established by the ground handling organisation.</div>
                </div>

                <div class="bordered-section checkbox-row">
                    <input type="checkbox">
                    <div class="statement-text">The ground handling organisation complies and will continue to comply with the occurrence-reporting obligations set out in [the essential requirements] point 4.2.2 of Annex VII to Regulation (EU) 2018/1139 and with the provisions of Regulation (EU) No 376/2014 and their delegated and implementing acts.</div>
                </div>

                <div class="bordered-section">
                    <div class="checkbox-row">
                        <input type="checkbox">
                        <div class="statement-text">(If applicable)<br>The ground handling organisation implements industry standards and good practices.</div>
                    </div>
                    <div style="margin-left: 30px; margin-top: 5px;">
                        <label>Name of the industry standards / good practices:</label>
                        <textarea rows="2" style="border: 1px solid #ccc; width: 100%;"></textarea>
                    </div>
                </div>

                <div class="bordered-section checkbox-row">
                    <input type="checkbox">
                    <div class="statement-text">The ground handling organisation will notify the competent authority of any changes to its organisation, the components of its management system, and its operation as declared herein and as detailed in point ORGH.DEC.100 of Annex I to Delegated Regulation (EU) 2025/20.</div>
                </div>
            </div>

            <div style="border: 1px solid black; border-top: none; margin-bottom: 20px;">
                 <div class="bordered-section checkbox-row">
                    <input type="checkbox">
                    <div class="statement-text">
                        The ground handling organisation confirms that all the necessary arrangements with the aerodrome operator(s) have been duly made in advance of starting operation, such as but not limited to:
                        <ol type="a" style="margin-top: 5px; margin-bottom: 5px;">
                            <li>the type of ground handling services intended to be provided at that aerodrome;</li>
                            <li>the date of starting the operation at the aerodrome;</li>
                            <li>methods of exchanging operational and relevant safety information with the aerodrome operator including the reporting and analysis of relevant safety occurrences; and</li>
                            <li>participation in the aerodrome safety committees.</li>
                        </ol>
                    </div>
                </div>

                <div class="bordered-section checkbox-row">
                    <input type="checkbox">
                    <div class="statement-text">The ground handling organisation confirms that the information disclosed in this declaration, including all Annexes, is correct.</div>
                </div>

                <div class="bordered-section checkbox-row">
                    <input type="checkbox">
                    <div class="statement-text">The ground handling organisation consents to the publication of its contact details provided in this declaration, either on the website of its national competent authority or on that of EASA, or on both, once the declaration has been received by the competent authority concerned.<br><br>.......................................................................................................</div>
                </div>

                <div class="bordered-section">
                    <div style="display: flex; gap: 20px; margin-bottom: 10px;">
                        <div style="flex: 0 0 160px;">
                            <label>Date:</label>
                            <input type="date">
                        </div>
                        <div style="flex: 1;">
                            <label>Name of Accountable Manager:</label>
                            <input type="text" placeholder="Type Full Name here">
                        </div>
                    </div>
                   
                    <label>Signature of Accountable Manager:</label>
                    <div class="signature-wrapper">
                        <canvas id="sigCanvas" width="600" height="150"></canvas>
                        <button type="button" class="sig-clear-btn" onclick="clearSignature()">X</button>
                        <div style="text-align: right; font-size: 10px; color: #888;">Sign within the box</div>
                    </div>
                </div>
            </div>

            <div class="page-break"></div>

            <div style="text-align: center; font-weight: bold; margin-bottom: 10px; font-style: italic;">
                Annex to the Declaration (*)
            </div>
            <div style="font-size: 0.9em; margin-bottom: 20px;">
                (*) To be filled individually for each aerodrome where the organisation provides ground handling services under this declaration.
            </div>

            <div style="border: 1px solid black;">
                <div class="bordered-section lookup-row">
                    <strong>Annex No <input type="text" style="width: 50px; display: inline;"> to the Declaration for</strong>
                    <div style="display: flex; gap: 10px; margin-top: 5px; align-items: center;">
                        <input type="text" class="field-icao" placeholder="ICAO (2)" style="width: 80px; text-transform: uppercase;" maxlength="4">
                        <input type="text" class="field-name" placeholder="Aerodrome Name (1)" style="flex-grow: 1;">
                        <input type="hidden" class="field-state">
                    </div>
                </div>

                <div class="bordered-section">
                    <strong>(1) Name, email and telephone number of the representative of the ground handling organisation at the aerodrome referred to in this Annex:</strong>
                    <input type="text" style="margin-top: 10px;">
                </div>

                <div class="bordered-section">
                    <strong>(2) Name, email and telephone number of the person responsible for the safety management at the aerodrome referred to in this Annex (*):</strong>
                    <input type="text" style="margin-top: 10px;">
                    <div style="font-size: 0.8em; font-style: italic; margin-top: 5px;">
                        Note: The same person may cumulate the responsibilities referred to in points (1) and (2) and may be responsible for more than one aerodrome.
                    </div>
                </div>

                <div class="bordered-section">
                    <strong>Starting date of operation at this aerodrome (*):</strong>
                    <input type="date" style="margin-top: 10px;">
                    <div style="font-size: 0.8em; margin-top: 10px;">
                        (*) If the organisation already provides services at this aerodrome at the date when this Regulation becomes applicable, this date shall indicate the date when the declaration is submitted.
                    </div>
                </div>
            </div>

            <div style="margin-top: 20px; font-weight: bold;">
                List of ground handling services provided at the aerodrome covered by this Annex to the Declaration, pursuant to <a href="https://www.easa.europa.eu/en/regulations/ground-handling">Article 2(2) of Delegated Regulation (EU) 2025/20</a>
            </div>

            <table style="width: 100%; margin-top: 10px;">
                <tr>
                    <td>Passenger handling (Article 2(2), point (a)) — please specify:<br><input type="text"></td>
                    <td width="5%" align="center"><input type="checkbox"></td>
                </tr>
                <tr>
                    <td>Handling of passengers with reduced mobility (Article 2(2), point (a))</td>
                    <td width="5%" align="center"><input type="checkbox"></td>
                </tr>
                <tr>
                    <td>Baggage handling (Article 2(2), point (b)) — please specify:<br><input type="text"></td>
                    <td width="5%" align="center"><input type="checkbox"></td>
                </tr>

                <tr>
                    <td colspan="2" style="background-color: transparent; border: none; padding-top: 15px; font-weight: bold;">Aircraft servicing</td>
                </tr>

                <tr>
                    <td>Operation of GSE used for ground handling services (Article 2(2), point (c)(i))</td>
                    <td align="center"><input type="checkbox"></td>
                </tr>
                <tr>
                    <td>Aircraft refuelling and defuelling – into-plane fuelling services (Article 2(2), point (c)(ii))</td>
                    <td align="center"><input type="checkbox"></td>
                </tr>
                <tr>
                    <td>Aircraft toilet servicing (Article 2(2), point (c)(iii))</td>
                    <td align="center"><input type="checkbox"></td>
                </tr>
                <tr>
                    <td>Aircraft potable water servicing (Article 2(2), point (c)(iv))</td>
                    <td align="center"><input type="checkbox"></td>
                </tr>
                <tr>
                    <td>Aircraft exterior cleaning (Article 2(2), point (c)(v))</td>
                    <td align="center"><input type="checkbox"></td>
                </tr>
                <tr>
                    <td>
                        Aircraft de-icing/anti-icing (Article 2(2), point (c)(vi)); also specify if supervision of de-icing/anti-icing is provided:<br>
                        <input type="text">
                    </td>
                    <td align="center"><input type="checkbox"></td>
                </tr>

                <tr>
                    <td colspan="2" style="background-color: transparent; border: none; padding-top: 15px; font-weight: bold;">Turnaround activities</td>
                </tr>

                <tr>
                    <td>Aircraft arrival activities (Article 2(2), point (d)(i))</td>
                    <td align="center"><input type="checkbox"></td>
                </tr>
                <tr>
                    <td>Aircraft loading/unloading (Article 2(2), point (d)(ii))</td>
                    <td align="center"><input type="checkbox"></td>
                </tr>
                <tr>
                    <td>Loading supervision (Article 2(2), point (d)(ii))</td>
                    <td align="center"><input type="checkbox"></td>
                </tr>
                <tr>
                    <td>Aircraft departure activities (Article 2(2), point (d)(iii))</td>
                    <td align="center"><input type="checkbox"></td>
                </tr>
                <tr>
                    <td>
                        Aircraft towing/pushback (Article 2(2), point (d)(iv)):
                        <div style="margin-top: 10px; display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
                            <div><label><input type="checkbox"> Towing</label></div>
                            <div><label><input type="checkbox"> Pushback</label></div>
                            <div><label><input type="checkbox"> Vehicle operation</label></div>
                            <div><label><input type="checkbox"> Headset communication</label></div>
                            <div><label><input type="checkbox"> Wing-person guidance</label></div>
                        </div>
                    </td>
                    <td align="center" style="vertical-align: top;"><input type="checkbox"></td>
                </tr>
            </table>

            <div class="ui-controls">
                <button type="button" class="btn btn-pdf" onclick="window.print()">Download as PDF / Print</button>
                <button type="button" class="btn btn-clear" onclick="clearForm()">Clear Form</button>
            </div>
        </form>
    </div>

    <script>
        const airportDb = {
            // --- NORWAY (Civil Airports) ---
            "ENGM": { name: "Oslo Airport, Gardermoen", state: "Norway" },
            "ENBR": { name: "Bergen Airport, Flesland", state: "Norway" },
            "ENZV": { name: "Stavanger Airport, Sola", state: "Norway" },
            "ENVA": { name: "Trondheim Airport, Værnes", state: "Norway" },
            "ENBO": { name: "Bodø Airport", state: "Norway" },
            "ENTC": { name: "Tromsø Airport, Langnes", state: "Norway" },
            "ENCN": { name: "Kristiansand Airport, Kjevik", state: "Norway" },
            "ENHD": { name: "Haugesund Airport, Karmøy", state: "Norway" },
            "ENAL": { name: "Ålesund Airport, Vigra", state: "Norway" },
            "ENTO": { name: "Sandefjord Airport, Torp", state: "Norway" },
            "ENML": { name: "Molde Airport, Årø", state: "Norway" },
            "ENKB": { name: "Kristiansund Airport, Kvernberget", state: "Norway" },
            "ENEV": { name: "Harstad/Narvik Airport, Evenes", state: "Norway" },
            "ENAT": { name: "Alta Airport", state: "Norway" },
            "ENKR": { name: "Kirkenes Airport, Høybuktmoen", state: "Norway" },
            "ENDU": { name: "Bardufoss Airport", state: "Norway" },
            "ENNA": { name: "Lakselv Airport, Banak", state: "Norway" },
            "ENSB": { name: "Svalbard Airport, Longyear", state: "Norway" },
            "ENSS": { name: "Vardø Airport, Svartnes", state: "Norway" },
            "ENHF": { name: "Hammerfest Airport", state: "Norway" },
            "ENHV": { name: "Honningsvåg Airport, Valan", state: "Norway" },
            "ENMH": { name: "Mehamn Airport", state: "Norway" },
            "ENBV": { name: "Berlevåg Airport", state: "Norway" },
            "ENBS": { name: "Båtsfjord Airport", state: "Norway" },
            "ENFG": { name: "Fagernes Airport, Leirin", state: "Norway" },
            "ENSD": { name: "Sandane Airport, Anda", state: "Norway" },
            "ENFL": { name: "Florø Airport", state: "Norway" },
            "ENBL": { name: "Førde Airport, Bringeland", state: "Norway" },
            "ENHO": { name: "Hovden Airport, Ørsta-Volda", state: "Norway" },
            "ENSG": { name: "Sogndal Airport, Haukåsen", state: "Norway" },
            "ENST": { name: "Sandnessjøen Airport, Stokka", state: "Norway" },
            "ENBN": { name: "Brønnøysund Airport, Brønnøy", state: "Norway" },
            "ENRA": { name: "Mo i Rana Airport, Røssvoll", state: "Norway" },
            "ENMS": { name: "Mosjøen Airport, Kjærstad", state: "Norway" },
            "ENLK": { name: "Leknes Airport", state: "Norway" },
            "ENSH": { name: "Svolvær Airport, Helle", state: "Norway" },
            "ENSR": { name: "Sørkjosen Airport", state: "Norway" },
            "ENHK": { name: "Hasvik Airport", state: "Norway" },
            "ENVD": { name: "Vadsø Airport", state: "Norway" },
            "ENOV": { name: "Ørsta–Volda Airport, Hovden", state: "Norway" },
            "ENRO": { name: "Røros Airport", state: "Norway" },
            "ENSO": { name: "Stord Airport, Sørstokken", state: "Norway" },
            "ENOL": { name: "Ørland Airport", state: "Norway" },
            "ENRY": { name: "Moss Airport, Rygge", state: "Norway" },
            "ENKJ": { name: "Kjeller Airport", state: "Norway" },
            "ENLI": { name: "Farsund Airport, Lista", state: "Norway" },
            "ENNO": { name: "Notodden Airport, Tuven", state: "Norway" },
            "ENRS": { name: "Røst Airport", state: "Norway" },
            "ENVR": { name: "Værøy Heliport", state: "Norway" },
           
            // --- EUROPEAN MAJOR HUBS ---
            "EDDK": { name: "Cologne Bonn Airport", state: "Germany" },
            "EDDF": { name: "Frankfurt Airport", state: "Germany" },
            "EGLL": { name: "London Heathrow", state: "UK" },
            "EGKK": { name: "London Gatwick", state: "UK" },
            "LFPG": { name: "Paris Charles de Gaulle", state: "France" },
            "EHAM": { name: "Amsterdam Airport Schiphol", state: "Netherlands" },
            "LEMD": { name: "Adolfo Suárez Madrid–Barajas", state: "Spain" },
            "EKCH": { name: "Copenhagen Airport", state: "Denmark" },
            "ESSA": { name: "Stockholm Arlanda", state: "Sweden" },
            "EFHK": { name: "Helsinki Airport", state: "Finland" }
        };

        // --- Auto-Fill Logic ---
        document.querySelectorAll('.field-icao').forEach(input => {
            input.addEventListener('input', function() {
                const code = this.value.toUpperCase().trim();
                const container = this.closest('.lookup-row');
                const nameField = container.querySelector('.field-name');
                const stateField = container.querySelector('.field-state');

                this.classList.remove('valid-code', 'invalid-code', 'unknown-code');

                if (code.length === 0) return;

                if (code.length < 4) return;
                if (!/^[A-Z]{4}$/.test(code)) {
                    this.classList.add('invalid-code');
                    return;
                }

                if (airportDb[code]) {
                    this.classList.add('valid-code');
                    if(nameField) nameField.value = airportDb[code].name;
                    if(stateField) stateField.value = airportDb[code].state;
                } else {
                    this.classList.add('unknown-code');
                }
            });

            input.addEventListener('blur', function() {
                this.value = this.value.toUpperCase();
            });
        });

        // --- Signature Pad Logic ---
        const canvas = document.getElementById('sigCanvas');
        const ctx = canvas.getContext('2d');
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;

        // Mouse Events
        canvas.addEventListener('mousedown', (e) => {
            isDrawing = true;
            [lastX, lastY] = [e.offsetX, e.offsetY];
        });
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', () => isDrawing = false);
        canvas.addEventListener('mouseout', () => isDrawing = false);

        // Touch Events
        canvas.addEventListener('touchstart', (e) => {
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            lastX = e.touches[0].clientX - rect.left;
            lastY = e.touches[0].clientY - rect.top;
            e.preventDefault();
        });
        canvas.addEventListener('touchmove', (e) => {
            if (!isDrawing) return;
            const rect = canvas.getBoundingClientRect();
            const currentX = e.touches[0].clientX - rect.left;
            const currentY = e.touches[0].clientY - rect.top;
           
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(currentX, currentY);
            ctx.stroke();
           
            [lastX, lastY] = [currentX, currentY];
            e.preventDefault();
        });
        canvas.addEventListener('touchend', () => isDrawing = false);

        function draw(e) {
            if (!isDrawing) return;
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(e.offsetX, e.offsetY);
            ctx.stroke();
            [lastX, lastY] = [e.offsetX, e.offsetY];
        }

        function clearSignature() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        // --- Clear Form Function ---
        function clearForm() {
            if (confirm("Are you sure you want to clear all data from the form? This action cannot be undone.")) {
                document.getElementById('declarationForm').reset();
                clearSignature(); // Wipes the canvas
                document.querySelectorAll('.valid-code, .invalid-code, .unknown-code').forEach(el => {
                    el.classList.remove('valid-code', 'invalid-code', 'unknown-code');
                });
                window.scrollTo(0, 0);
            }
        }
    </script>
</body>

</html>
